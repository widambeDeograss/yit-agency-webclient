import{c as n,P as V,u as J,Q as X,r as N,a as Y,b as ee,x,j as e,B as r,S as b,F as j}from"./index-XddlkiPy.js";import{u as L,B as se}from"./badge-A3J6BesA.js";import{A as f,a as k,b as y}from"./avatar-15CIWND8.js";import{T as ae}from"./textarea-XLJ2C__l.js";import{C as te,b as d}from"./blogs.service-CqU0qno4.js";import{a as re}from"./account.service-DxK2iDcM.js";import{B as ie,r as le,a as de}from"./index-CwnciZOS.js";import{B as ne,M as ce}from"./index-Dpuw5jZU.js";import{S as oe}from"./share-2-BvOrPSLC.js";import{C as me}from"./chevron-down-gCCBar_D.js";import"./index-DjG5M9zQ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]],he=n("clapperboard",ue);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]],je=n("heart",xe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]],ve=n("reply",pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],Ne=n("rocket",ge);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],fe=n("thumbs-down",be);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],ye=n("thumbs-up",ke),P={like:e.jsx(ye,{className:"h-4 w-4"}),dislike:e.jsx(fe,{className:"h-4 w-4"}),heart:e.jsx(je,{className:"h-4 w-4"}),rocket:e.jsx(Ne,{className:"h-4 w-4"}),clap:e.jsx(he,{className:"h-4 w-4"})},Pe=()=>{var A;const{id:t}=V(),c=J(),o=X(),[u,C]=N.useState(""),[m,p]=N.useState(null),[_,E]=N.useState({}),{isAuthenticated:v}=Y(),g=ee(),{data:a,isLoading:$,isError:D,error:S}=L({queryKey:["blog",t],queryFn:()=>d.getBlogDetail(t)}),{data:B,isLoading:H}=L({queryKey:["blog-comments",t],queryFn:()=>d.getBlogComments(t)}),I=x({mutationFn:s=>d.addReactionToBlog(t,s),onSuccess:()=>{o.invalidateQueries({queryKey:["blog",t]}),o.invalidateQueries({queryKey:["blog-comments",t]})}}),Q=x({mutationFn:()=>d.removeReactionFromBlog(t),onSuccess:()=>{o.invalidateQueries({queryKey:["blog",t]})}}),M=x({mutationFn:()=>m?d.replyToComment(m,u):d.createBlogComment(t,u),onSuccess:()=>{C(""),p(null),o.invalidateQueries({queryKey:["blog-comments",t]})}}),K=async()=>{const s=`Check out this ARTICLE: ${a==null?void 0:a.title}
${window.location.href}`;if(navigator.share)try{await navigator.share({title:a==null?void 0:a.title,text:`Check out this blog: ${a==null?void 0:a.title}`,url:window.location.href});return}catch{console.log("Web Share failed, falling back to clipboard")}try{await navigator.clipboard.writeText(s),j.info("Link copied to clipboard! 🎉")}catch(i){console.error("Failed to copy:",i),j.info("Could not copy link. Please try manually.")}},U=s=>{if(!v){g(b(!0));return}(a==null?void 0:a.user_reaction)===s?Q.mutate():I.mutate(s)},{mutate:O,isPending:Z}=x({mutationFn:()=>re.toogleBookMark({content_type:"blog",object_id:a==null?void 0:a.id,bookmark_type:"blog"}),onSuccess:()=>{j.success("Forum bookmarked successfully"),o.invalidateQueries({queryKey:["blog",t]})},onError:s=>{console.error("Error bookmarking forum:",s),j.error("Failed to bookmark forum. Please try again.")}}),G=()=>{g(b(!0))},W=s=>{E(i=>({...i,[s]:!i[s]}))};return $?e.jsx("div",{className:"max-w-4xl mx-auto py-8 px-4",children:e.jsx(we,{})}):D?e.jsxs("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"text-red-500",children:["Error loading blog: ",S instanceof Error?S.message:"Unknown error"]}),e.jsx(r,{onClick:()=>c(-1),className:"mt-4",children:"Go Back"})]}):a?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("article",{className:"mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(r,{variant:"ghost",onClick:()=>c(-1),children:"← Back to blogs"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{if(v)O();else{G();return}},disabled:Z,children:(A=a.bookmark_status)!=null&&A.is_bookmarked?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Saved"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Save"]})}),e.jsx(r,{variant:"ghost",size:"icon",onClick:K,children:e.jsx(oe,{className:"h-4 w-4"})})]})]}),e.jsxs("header",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-4",children:a.categories.map(s=>e.jsx(se,{variant:"secondary",children:s.name},s.id))}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:a.title}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(f,{children:[e.jsx(k,{src:a.author.profileImage??void 0}),e.jsx(y,{children:a.author.username.substring(0,2).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.author.username}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[w(a.published_at||a.created_at)," · ",a.views," views"]})]})]})]}),a.featured_image&&e.jsx("div",{className:"mb-8 rounded-lg overflow-hidden",children:e.jsx("img",{src:a.featured_image,alt:a.title,className:"w-full h-auto max-h-96 object-cover"})}),e.jsx("div",{className:"prose max-w-none dark:prose-invert",children:e.jsx(ce,{remarkPlugins:[de],rehypePlugins:[le],children:a.content})}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex gap-2",children:Object.entries(P).map(([s,i])=>e.jsx(r,{variant:a.user_reaction===s?"default":"outline",size:"sm",onClick:()=>U(s),children:i},s))}),e.jsx("div",{className:"text-sm text-muted-foreground"})]})})]}),e.jsxs("section",{className:"border-t pt-8",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["Comments ",B&&`(${B.count})`]}),e.jsxs("div",{className:"mb-8",children:[e.jsx(ae,{placeholder:m?"Write your reply...":"Write a comment...",value:u,onChange:s=>C(s.target.value),className:"mb-2"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[m&&e.jsx(r,{variant:"ghost",onClick:()=>p(null),children:"Cancel"}),e.jsx(r,{onClick:()=>v?M.mutate():g(b(!0)),disabled:!u.trim()||M.isPending,children:m?"Reply":"Comment"})]})]}),H?e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{}),e.jsx(z,{})]}):e.jsx("div",{className:"space-y-6",children:a==null?void 0:a.comments.map(s=>{var i,R,F;return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(f,{children:[e.jsx(k,{src:((i=s.author)==null?void 0:i.profileImage)??void 0}),e.jsx(y,{children:((R=s.author)==null?void 0:R.username.substring(0,2).toUpperCase())||"AN"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((F=s.author)==null?void 0:F.username)||"[deleted]"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:w(s.created_at)})]}),e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>p(s.id),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Reply"]})]}),e.jsx("p",{className:"mb-4",children:s.content}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex gap-1",children:Object.entries(P).map(([l,h])=>e.jsx(r,{variant:s.user_reaction===l?"default":"ghost",size:"sm",className:"h-8 w-8 p-0",children:h},l))}),s.replies&&s.replies.length>0&&e.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>W(s.id),children:[_[s.id]?e.jsx(te,{className:"h-4 w-4 mr-1"}):e.jsx(me,{className:"h-4 w-4 mr-1"}),s.replies.length," replies"]})]}),_[s.id]&&s.replies&&e.jsx("div",{className:"mt-4 pl-6 border-l-2",children:s.replies.map(l=>{var h,q,T;return e.jsx("div",{className:"py-4 border-b last:border-b-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{className:"h-8 w-8",children:[e.jsx(k,{src:((h=l.author)==null?void 0:h.profileImage)??void 0}),e.jsx(y,{children:((q=l.author)==null?void 0:q.username.substring(0,2).toUpperCase())||"AN"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"text-sm font-medium",children:((T=l.author)==null?void 0:T.username)||"[deleted]"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:w(l.created_at)})]}),e.jsx("p",{className:"text-sm",children:l.content})]})]})},l.id)})})]})]})},s.id)})})]})]}):e.jsxs("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[e.jsx("div",{children:"Blog post not found"}),e.jsx(r,{onClick:()=>c(-1),className:"mt-4",children:"Go Back"})]})},w=t=>{const c=new Date(t);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(c)},we=()=>e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{className:"h-10 w-32 bg-muted rounded-md"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-muted rounded-full"}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded-full"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"h-6 w-20 bg-muted rounded-full"}),e.jsx("div",{className:"h-6 w-20 bg-muted rounded-full"})]}),e.jsx("div",{className:"h-10 w-3/4 bg-muted rounded-md mb-4"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 bg-muted rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-5 w-32 bg-muted rounded-md mb-2"}),e.jsx("div",{className:"h-4 w-48 bg-muted rounded-md"})]})]})]}),e.jsx("div",{className:"h-64 w-full bg-muted rounded-lg mb-8"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded-md"}),e.jsx("div",{className:"h-4 w-full bg-muted rounded-md"}),e.jsx("div",{className:"h-4 w-3/4 bg-muted rounded-md"})]})]}),z=()=>e.jsx("div",{className:"border rounded-lg p-4 animate-pulse",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-5 w-32 bg-muted rounded-md mb-1"}),e.jsx("div",{className:"h-4 w-24 bg-muted rounded-md"})]}),e.jsx("div",{className:"h-8 w-16 bg-muted rounded-md"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"h-4 w-full bg-muted rounded-md"}),e.jsx("div",{className:"h-4 w-5/6 bg-muted rounded-md"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-muted rounded-md"}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded-md"}),e.jsx("div",{className:"h-8 w-8 bg-muted rounded-md"})]})]})]})});export{Pe as default};
