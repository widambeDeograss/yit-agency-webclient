import{O as H,u as Y,a as G,b as J,r as i,j as e,B as d,C as V,I as W,L as X,S as Z}from"./index-ux5oNEAr.js";import{u as h,B as o,A as ee,a as se,b as ae}from"./avatar-CIvInjWZ.js";import{P as te,p as g}from"./polls.services-B7kcf7WV.js";import{T as le,a as re,b as de,c as ie}from"./tabs-BxN1H10p.js";import{C as j,a as f,b,c as p}from"./card-CNPuq_RZ.js";import{f as ce}from"./forums.services-Dguo6Qbc.js";import{S as ne,F as me}from"./search-CRL-JZJS.js";import{U as $}from"./users-BG2cZW_u.js";import{S as oe}from"./share-2-DJWy7QZA.js";import{C as xe}from"./clock-BSMIzl9a.js";import{L as ue}from"./loader-circle-Dfx8oZ5t.js";import{C as he}from"./calendar-B2r9t42S.js";import"./index-D92uPXsy.js";import"./index-CoRKDfse.js";const Ae=()=>{var C,_,k,T,D,L,P;const{id:t}=H(),c=Y(),{isAuthenticated:q}=G(),z=J(),[n,B]=i.useState(null),[x,N]=i.useState(!1),[je,fe]=i.useState(""),[v,M]=i.useState(""),[w,R]=i.useState(null),{data:a,isLoading:O,error:E,refetch:y}=h({queryKey:["poll",t],queryFn:()=>g.getPollDetail(Number(t)),enabled:!!t}),{data:l}=h({queryKey:["relatedPolls",t],queryFn:()=>g.getPolls(),enabled:!!t}),{data:m}=h({queryKey:["categories"],queryFn:()=>ce.getForumCategories()}),U=async()=>{if(!q){z(Z(!0));return}if(n!==null){N(!0);try{await g.createVote({poll:Number(t),option:n}),y()}catch(s){console.error("Failed to vote:",s)}finally{N(!1)}}},I=s=>{R(s===w?null:s),c(`/polls?category=${s}`)},K=s=>{s.preventDefault(),c(`/polls?search=${v}`)},Q=()=>{const s=window.location.href;navigator.clipboard.writeText(s),alert("Poll URL copied to clipboard!")},S=()=>{if(!(a!=null&&a.ends_at))return null;const s=new Date(a.ends_at),r=new Date;if(r>s)return"Poll ended";const u=Math.abs(s.getTime()-r.getTime()),F=Math.floor(u/(1e3*60*60*24));if(F>0)return`${F} days left`;const A=Math.floor(u%(1e3*60*60*24)/(1e3*60*60));return A>0?`${A} hours left`:`${Math.floor(u%(1e3*60*60)/(1e3*60))} minutes left`};return a!=null&&a.options.reduce((s,r)=>s+(r.vote_count||0),0),O?e.jsx(ge,{}):E||!a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500",children:"Failed to load poll details"}),e.jsx(d,{variant:"outline",className:"mt-4",onClick:()=>y(),children:"Retry"})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"hidden lg:block lg:col-span-1",children:e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-sm border border-border/50 sticky top-20",children:[e.jsxs(d,{variant:"ghost",size:"sm",className:"mb-4",onClick:()=>c("/polls"),children:[e.jsx(V,{className:"h-4 w-4 mr-1"})," Back to Polls"]}),e.jsx("form",{onSubmit:K,className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(W,{placeholder:"Search polls...",className:"pl-8",value:v,onChange:s=>M(s.target.value)}),e.jsx(d,{type:"submit",variant:"default",size:"sm",className:"absolute right-1 top-1",children:"Search"})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),e.jsx("h3",{className:"font-medium",children:"Categories"})]}),e.jsx("div",{className:"space-y-2",children:m!=null&&m.results?m.results.map(s=>e.jsxs(o,{variant:w===s.id?"default":"outline",className:"mr-2 mb-2 cursor-pointer hover:bg-primary/10 hover:text-primary w-full justify-between",onClick:()=>I(s.id),children:[s.name,e.jsx("span",{className:"ml-auto bg-background/80 text-xs px-1.5 py-0.5 rounded-sm",children:0})]},s.id)):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No categories found"})})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-border",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Related Polls"}),e.jsxs("div",{className:"space-y-3",children:[(C=l==null?void 0:l.results)==null?void 0:C.slice(0,5).map(s=>e.jsxs(X,{to:`/polls/${s.id}`,className:"block bg-background rounded-lg p-3 hover:bg-accent transition-colors",children:[e.jsx("h4",{className:"font-medium text-sm line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mt-1",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),e.jsxs("span",{children:[s.total_votes," votes"]})]})]},s.id)),(!(l!=null&&l.results)||l.results.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No related polls found"})]})]})]})}),e.jsxs("div",{className:"col-span-1 lg:col-span-3",children:[e.jsx("div",{className:"lg:hidden mb-4",children:e.jsxs(d,{variant:"ghost",size:"sm",onClick:()=>c("/polls"),className:"w-full justify-start",children:[e.jsx(V,{className:"h-4 w-4 mr-1"})," Back to Polls"]})}),e.jsxs("div",{className:"bg-card rounded-xl shadow-sm hover:shadow-md transition-all duration-300 border border-border/50 overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-10 w-10",children:(_=a.created_by)!=null&&_.profile_image?e.jsx(se,{src:a.created_by.profile_image,alt:a.created_by.username}):e.jsx(ae,{children:((T=(k=a.created_by)==null?void 0:k.username)==null?void 0:T.slice(0,2).toUpperCase())||"??"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:((D=a.created_by)==null?void 0:D.username)||"Anonymous"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Posted a poll â€¢ ",new Date(a.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:space-x-2",children:[e.jsx(o,{variant:"outline",className:"text-sm bg-amber-100 text-amber-800 border-amber-200",children:S()}),e.jsxs(d,{variant:"outline",size:"sm",onClick:Q,className:"w-full sm:w-auto",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"})," Share"]})]})]}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mt-4",children:a.title}),a.description&&e.jsx("p",{className:"text-muted-foreground mt-2",children:a.description}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:(L=a.categories)==null?void 0:L.map(s=>e.jsxs(o,{variant:"outline",className:"hover:bg-primary/10 hover:text-primary",children:["#",s]},s))})]}),a.featured_image&&e.jsx("div",{className:"relative",children:e.jsx("img",{src:a.featured_image,alt:a.title,className:"w-full h-48 sm:h-64 object-cover"})}),e.jsxs(le,{defaultValue:"vote",className:"p-4 sm:p-6",children:[e.jsx(re,{className:"grid w-full grid-cols-2",children:e.jsx(de,{value:"vote",children:"Vote"})}),e.jsx(ie,{value:"vote",className:"mt-6",children:e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Cast your vote"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(xe,{className:"h-4 w-4 mr-1 text-muted-foreground"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Ends on ",new Date(a.ends_at).toLocaleDateString()]})]})]}),e.jsx("div",{className:"space-y-4",children:a.options.map(s=>e.jsxs("div",{className:"bg-background rounded-lg p-4 border border-border/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:`poll-${a.id}`,className:"h-5 w-5 text-primary",onChange:()=>B(s.id),checked:n===s.id,disabled:a.user_vote!==null||x}),e.jsx("span",{className:"text-base sm:text-lg",children:s.text})]})}),e.jsxs("span",{className:"text-lg font-semibold",children:[s.vote_percentage,"%"]})]}),e.jsx(te,{value:s.vote_percentage,className:"h-3 rounded-md",indicatorClassName:s.id===1?"bg-blue-500":s.id===2?"bg-green-500":s.id===3?"bg-red-500":s.id===4?"bg-purple-500":s.id===5?"bg-yellow-500":s.id===6?"bg-cyan-500":s.id===7?"bg-orange-500":"bg-primary"}),e.jsxs("div",{className:"mt-2 text-sm text-muted-foreground text-right",children:[s.vote_count," votes"]})]},s.id))}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row sm:justify-between sm:items-center gap-4 mt-8",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsx($,{className:"h-4 w-4 inline mr-1"}),e.jsxs("span",{children:[a.total_votes," total votes"]})]}),a.user_vote?e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 w-full sm:w-auto",children:[e.jsx(d,{variant:"outline",size:"lg",disabled:!0,className:"w-full sm:w-auto",children:"Already Voted"}),e.jsxs(o,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200 w-full sm:w-auto text-center",children:["You voted for: ",(P=a.options.find(s=>s.id===a.user_vote))==null?void 0:P.text]})]}):e.jsx(d,{variant:"default",size:"lg",onClick:U,disabled:n===null||x,className:"w-full sm:w-auto",children:x?e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-4 w-4 animate-spin mr-2"}),"Submitting..."]}):"Submit Vote"})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg mt-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(he,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx("h4",{className:"font-medium",children:"Poll Timeline"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Started"}),e.jsx("p",{className:"font-medium",children:new Date(a.starts_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Ends"}),e.jsx("p",{className:"font-medium",children:new Date(a.ends_at).toLocaleString()})]})]})]})]})})]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-4 sm:p-6 shadow-sm border border-border/50 mt-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Poll Stats"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[e.jsxs(j,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Total Votes"})}),e.jsx(p,{children:e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:a.total_votes})})]}),e.jsxs(j,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Time Remaining"})}),e.jsx(p,{children:e.jsx("div",{className:"text-xl sm:text-2xl font-bold",children:S()})})]}),e.jsxs(j,{children:[e.jsx(f,{className:"pb-2",children:e.jsx(b,{className:"text-sm font-medium text-muted-foreground",children:"Leading Option"})}),e.jsx(p,{children:e.jsx("div",{className:"text-base sm:text-xl font-bold truncate",children:a.options.reduce((s,r)=>s.vote_count>r.vote_count?s:r).text})})]})]})]})]})]})})},ge=()=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"hidden lg:block lg:col-span-1",children:e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-sm border border-border/50 animate-pulse",children:[e.jsx("div",{className:"h-8 w-24 bg-muted rounded mb-4"}),e.jsx("div",{className:"h-10 w-full bg-muted rounded mb-6"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-5 w-full bg-muted rounded"}),e.jsx("div",{className:"h-6 w-full bg-muted rounded"}),e.jsx("div",{className:"h-6 w-full bg-muted rounded"}),e.jsx("div",{className:"h-6 w-full bg-muted rounded"})]})]})}),e.jsx("div",{className:"col-span-1 lg:col-span-3",children:e.jsxs("div",{className:"bg-card rounded-xl p-4 sm:p-6 shadow-sm border border-border/50 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-muted"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-5 w-32 bg-muted rounded"}),e.jsx("div",{className:"h-3 w-40 bg-muted rounded mt-1"})]})]}),e.jsx("div",{className:"h-8 w-3/4 bg-muted rounded mb-4"}),e.jsx("div",{className:"h-4 w-1/2 bg-muted rounded mb-4"}),e.jsx("div",{className:"h-48 sm:h-64 bg-muted rounded-lg mb-6"}),e.jsx("div",{className:"h-10 w-full bg-muted rounded mb-6"}),e.jsx("div",{className:"space-y-6",children:[1,2,3].map(t=>e.jsx("div",{className:"h-20 bg-muted rounded"},t))}),e.jsx("div",{className:"h-12 w-32 bg-muted rounded mt-6 ml-auto"})]})})]});export{Ae as default};
